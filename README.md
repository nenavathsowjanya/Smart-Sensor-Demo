ESP32 MQTT Light & Soil MonitorThis MicroPython project turns an ESP32 into a simple IoT environmental monitoring station. It reads data from a BH1750 light sensor and an analog soil moisture sensor, then publishes this data to a public MQTT broker.It also subscribes to an MQTT topic to allow for remote control of two LEDs (red and blue). This project is pre-configured to run in the Wokwi simulator using the Wokwi-GUEST WiFi.ðŸ“‹ FeaturesMQTT Communication: Connects to the public test.mosquitto.org broker.Light Sensing: Reads ambient light in Lux using a BH1750 I2C sensor.Soil Moisture Sensing: Reads analog soil moisture and converts it to a 0-100% value.Remote Control: Subscribes to a topic to control two separate LEDs via JSON commands.WiFi Connectivity: Automatically connects to the 'Wokwi-GUEST' network.ðŸ› ï¸ Hardware RequiredESP32 DevKitC V4 (or similar)BH1750 Ambient Light SensorAnalog Soil Moisture Sensor (Capacitive recommended)1x Red LED1x Blue LEDJumper WiresðŸ”Œ Connections (Pinout)This pinout is based on the main.py script.ComponentPin on ESP32BH1750 SCLGPIO 22BH1750 SDAGPIO 21Soil Moisture (AOUT)GPIO 34 (ADC)Red LED (led_1)GPIO 23Blue LED (led_2)GPIO 19BH1750 VCC / GND3.3V / GNDSoil Sensor VCC / GND3.3V / GNDLED Cathodes (-)GNDðŸ“¦ Software & LibrariesMicroPython for ESP32umqtt.simple: A lightweight MQTT client for MicroPython.bh1750.py: The device driver for the BH1750 sensor.Important: You must have the bh1750.py file in the same directory as your main.py for the project to work.ðŸš€ How to UseSet up Hardware: Connect the components according to the "Connections (Pinout)" table above.Add Driver: Ensure the bh1750.py file is present in your project's root directory.Run: Start the simulation (or flash the code to a real ESP32). The device will print its connection status to the console.Monitor & Control: Use any MQTT client (like MQTT Explorer) to interact with the device.ðŸ“¡ MQTT IntegrationThe script connects to test.mosquitto.org with the Client ID mqtt-demo-new-sensors.â¬†ï¸ Publishing (ESP32 -> Broker)The device publishes sensor data every 5 seconds to two separate topics.1. Light SensorTopic: mqtt-demo/lightPayload Format: A JSON object containing the light reading in Lux and a timestamp.Example Payload:JSON{"light_lux": 120.5, "timestamp": 1678886400}
2. Soil Moisture SensorTopic: mqtt-demo/moisturePayload Format: A JSON object with the raw ADC value, the calculated percentage, and a timestamp.Example Payload:JSON{"moisture_raw": 2500, "moisture_perc": 65.2, "timestamp": 1678886401}
(Note: The percentage is calculated based on the MIN_MOISTURE_RAW and MAX_MOISTURE_RAW calibration values in the code.)â¬‡ï¸ Subscribing (Broker -> ESP32)The device listens on one topic to control the two LEDs.Topic: mqtt-demo/ledPayload Format: A JSON object specifying the led number (1 or 2) and the desired state ("on" or "off").Example Commands:To turn the Red LED (LED 1) ON:Topic: mqtt-demo/ledPayload: {"led": 1, "state": "on"}To turn the Blue LED (LED 2) OFF:Topic: mqtt-demo/ledPayload: {"led": 2, "state": "off"}
